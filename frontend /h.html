<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexa CCTV — Auth</title>
    <link rel="stylesheet" href="./css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h2>Create Account</h2>
      <form id="signupForm">
        <input type="text" name="firstname" placeholder="First Name" required />
        <input type="text" name="lastname" placeholder="Last Name" required />
        <input type="tel" name="phone" placeholder="Phone" required />
        <input type="text" name="apikey" placeholder="API Key" required />
        <input type="password" name="password" placeholder="Password" required />
        <button type="submit">Sign Up</button>
      </form>

      <h2>Login</h2>
      <form id="loginForm">
        <input type="tel" name="phone" placeholder="Phone" required />
        <input type="password" name="password" placeholder="Password" required />
        <button type="submit">Login</button>
      </form>

      <p id="msg"></p>
    </div>

    <script type="module">
      const BASE_URL = "https://nexa-mini.onrender.com/api/auth";
      const msg = document.getElementById("msg");

      // Utility: show messages nicely
      const showMsg = (text, type = "info") => {
        msg.textContent = text;
        msg.style.color = type === "error" ? "red" : "green";
      };

      // ✅ Sign up
      document.getElementById("signupForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        showMsg("Creating account...");
        const data = Object.fromEntries(new FormData(e.target));

        try {
          const res = await axios.post(`${BASE_URL}/register`, data);
          showMsg("✅ Account created successfully!");
          
          console.log(res.data);
        } catch (err) {
          const message =
            err.response?.data?.message ||
            err.response?.data?.error ||
            "Server validation failed. Please check your inputs.";
          showMsg("❌ " + message, "error "+res);
          
        }
      });

      // ✅ Login
      document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        showMsg("Logging in...");
        const data = Object.fromEntries(new FormData(e.target));

        try {
          const res = await axios.post(`${BASE_URL}/login`, data);
          showMsg("✅ Login successful!");
          localStorage.setItem("token", res.data.token);
          setTimeout(() => (window.location.href = "dashboard.html"), 1000);
        } catch (err) {
          const message =
            err.response?.data?.message ||
            err.response?.data?.error ||
            "Login failed. Check credentials.";
          showMsg("❌ " + message, "error");
        }
      });
    </script>
  </body>
</html>